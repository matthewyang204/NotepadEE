# Check for a .configured file generated by configure script
ifeq ($(wildcard .configured),)
$(error You must run `./configure` before you can build.)
endif

# Variables
APP_NAME = Notepad==
BUILD_DIR = dist
INSTALL_DIR = /opt/matthewyang
BIN_LINK = /usr/local/bin/notepadee
DESKTOP_FILE = /usr/share/applications/notepadee.desktop
VERSION_NUMBER = 5.2.4

.SILENT:

all: build

configure:
	./configure

build:
	pyinstaller --hidden-import=tkinter --windowed -i Notepad.ico src/$(APP_NAME).py
	cp Notepad.ico dist/Notepad==/
	touch dist/Notepad==/.pyinstaller
	$(MAKE) windows-app-icon
	echo "Build completed. To install, run 'sudo make install'"

windows-app-icon:
	cp Notepad.ico dist\Notepad==\_internal\

inno-setup:
	"@ISCC@" @ISCSCRIPT@
	echo "Inno Setup installer created."

install:
	$(MAKE) bin-dist
	Output/*.exe

run:
	dist/Notepad==/Notepad==.exe

uninstall:
	@echo "This operation is not supported on Windows. Please use the Apps & Features settings or control panel to uninstall Notepad==."

clean: clean-dist clean-bin-dist
	rm -rf dist
	rm -rf build
	rm -rf $(APP_NAME).spec
	rm -rf Output
	echo "Cleaned all temp files used"

dist: clean
	mkdir ../temp
	cp -R ./* ../temp/
	tar -czvf NotepadEE-Windows-src.tar.gz -C ../temp .
	rm -rf ../temp

clean-dist:
	rm -rf NotepadEE-Windows-src.tar.gz
	rm -rf ../temp

bin-dist:
	$(MAKE) inno-setup

clean-bin-dist: 
	rm -rf Output

upgrade: uninstall-upgrade install

.PHONY: all configure build install uninstall clean dist bin-dist upgrade inno-setup windows-app-icon clean-dist clean-bin-dist
